<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∫∑Â∫∑Áî©ÈîÖÂàáÂàáÂàá - ËçØÂ∏àÂ∏ÆOAÂ§ß‰π±Êñó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            overflow: hidden;
            user-select: none;
            cursor: none;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* ÁôªÂΩïÁïåÈù¢ */
        .login-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }

        .login-box {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
        }

        .login-box h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .login-box h2 {
            color: #666;
            margin-bottom: 35px;
            font-size: 18px;
        }

        .login-box input {
            padding: 18px;
            width: 350px;
            border: 3px solid #ddd;
            border-radius: 15px;
            font-size: 18px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .login-box input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 20px rgba(102,126,234,0.3);
        }

        .login-box button {
            padding: 18px 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
        }

        .login-box button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102,126,234,0.4);
        }

        /* Ê∏∏ÊàèÁïåÈù¢ */
        .game-screen {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Ê∏∏ÊàèÁîªÂ∏É */
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 50%, #90EE90 100%);
            cursor: none;
        }

        /* Â∫∑Â∫∑ËßíËâ≤ */
        .kangkang-character {
            position: absolute;
            bottom: 30px;
            left: 30px;
            width: 160px;
            height: 200px;
            z-index: 10;
        }

        .character-name {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            color: #333;
            font-weight: bold;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .kangkang-body {
            width: 100px;
            height: 120px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative;
            animation: kangkangBounce 1.5s ease-in-out infinite;
            margin: 20px auto 0;
            border: 3px solid #333;
        }

        .kangkang-head {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #fdbcb4, #f7a399);
            border-radius: 50%;
            position: absolute;
            top: -40px;
            left: 10px;
            border: 3px solid #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .kangkang-face {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 32px;
            animation: faceChange 3s ease-in-out infinite;
        }

        .kangkang-hair {
            position: absolute;
            top: -10px;
            left: 15px;
            width: 50px;
            height: 30px;
            background: #2c3e50;
            border-radius: 50% 50% 0 0;
        }

        .kangkang-arm {
            width: 50px;
            height: 20px;
            background: linear-gradient(45deg, #fdbcb4, #f7a399);
            border-radius: 15px;
            position: absolute;
            top: 25px;
            right: -45px;
            transform-origin: left center;
            animation: armThrow 0.8s ease-in-out infinite;
            border: 2px solid #333;
        }

        .kangkang-hand {
            position: absolute;
            right: -15px;
            top: -5px;
            width: 30px;
            height: 30px;
            background: #fdbcb4;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .kangkang-legs {
            position: absolute;
            bottom: -25px;
            left: 20px;
            width: 60px;
            height: 40px;
        }

        .kangkang-leg {
            width: 25px;
            height: 35px;
            background: #2c3e50;
            border-radius: 15px;
            position: absolute;
            border: 2px solid #333;
        }

        .kangkang-leg.left {
            left: 0;
            animation: legMove 1.5s ease-in-out infinite;
        }

        .kangkang-leg.right {
            right: 0;
            animation: legMove 1.5s ease-in-out infinite 0.75s;
        }

        @keyframes kangkangBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-15px) scale(1.05); }
        }

        @keyframes armThrow {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(-60deg); }
            70% { transform: rotate(-80deg); }
            100% { transform: rotate(0deg); }
        }

        @keyframes faceChange {
            0%, 40% { content: 'üò§'; }
            50%, 70% { content: 'üò†'; }
            80%, 100% { content: 'ü§¨'; }
        }

        @keyframes legMove {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(10deg); }
        }

        /* ÂØπËØùÊ≥°Ê≥° */
        .speech-bubble {
            position: absolute;
            bottom: 220px;
            left: 10px;
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            border: 3px solid #333;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            max-width: 220px;
            animation: bubbleShow 4s ease-in-out;
            z-index: 15;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -18px;
            left: 40px;
            width: 0;
            height: 0;
            border-left: 18px solid transparent;
            border-right: 18px solid transparent;
            border-top: 18px solid white;
        }

        @keyframes bubbleShow {
            0% { opacity: 0; transform: scale(0) rotate(-10deg); }
            15% { opacity: 1; transform: scale(1) rotate(0deg); }
            85% { opacity: 1; transform: scale(1) rotate(0deg); }
            100% { opacity: 0; transform: scale(0) rotate(10deg); }
        }

        /* UIÁïåÈù¢ */
        .game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        .score-panel {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(255,255,255,0.9);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .score-item {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .time-item {
            font-size: 28px;
            font-weight: bold;
            color: #ff6b6b;
        }

        /* ÊéíË°åÊ¶ú */
        .leaderboard {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 20px;
            width: 280px;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .leaderboard h3 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(102,126,234,0.1);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            background: rgba(102,126,234,0.2);
        }

        .leaderboard-item.top3 {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }

        /* Ê∏∏ÊàèÁªìÊùüÁïåÈù¢ */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }

        .game-over-box {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 25px 70px rgba(0,0,0,0.4);
            border: 3px solid #667eea;
        }

        .game-over-box h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .game-over-box p {
            color: #666;
            margin-bottom: 35px;
            font-size: 20px;
        }

        .game-over-box button {
            padding: 18px 35px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            margin: 0 15px;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
        }

        .game-over-box button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102,126,234,0.4);
        }

        /* Èº†Ê†áÂàÄÂÖâÊïàÊûú */
        .knife-trail {
            position: absolute;
            pointer-events: none;
            z-index: 5;
        }

        .hidden {
            display: none !important;
        }

        /* ËøûÂáªÊïàÊûú */
        .combo-text {
            position: absolute;
            font-size: 48px;
            font-weight: bold;
            color: #ff6b6b;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            animation: comboAnimation 1s ease-out forwards;
            z-index: 25;
            pointer-events: none;
        }

        @keyframes comboAnimation {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(0);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) translateY(-20px);
            }
            100% {
                opacity: 0;
                transform: scale(1) translateY(-50px);
            }
        }

        /* ÂàáÈîÖÂêêÊßΩÊ≥°Ê≥° */
        .slice-complaint {
            position: absolute;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
            animation: sliceComplaintAnimation 2s ease-out forwards;
            z-index: 30;
            pointer-events: none;
            border: 2px solid #fff;
        }

        @keyframes sliceComplaintAnimation {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(0);
            }
            30% {
                opacity: 1;
                transform: scale(1) translateY(-20px);
            }
            70% {
                opacity: 1;
                transform: scale(1) translateY(-40px);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(-80px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÁôªÂΩïÁïåÈù¢ -->
        <div class="login-screen" id="loginScreen">
            <div class="login-box">
                <h1>üî™ Â∫∑Â∫∑Áî©ÈîÖÂàáÂàáÂàá ü•ò</h1>
                <h2>ËçØÂ∏àÂ∏ÆOAÂ§ß‰π±Êñó - ÈÄÄÁæ§‰º†ËØ¥</h2>
                <input type="text" id="nicknameInput" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÊòµÁß∞ÂºÄÂßãÂàáÈîÖ" maxlength="20">
                <br>
                <button onclick="startGame()">ÂºÄÂßãÁî©ÈîÖÂ§ßÊàò</button>
            </div>
        </div>

        <!-- Ê∏∏ÊàèÁïåÈù¢ -->
        <div class="game-screen hidden" id="gameScreen">
            <!-- Ê∏∏ÊàèÁîªÂ∏É -->
            <canvas id="gameCanvas"></canvas>
            
            <!-- Â∫∑Â∫∑ËßíËâ≤ -->
            <div class="kangkang-character" id="kangkangCharacter">
                <div class="character-name">È¶ñÊé®Â∫∑Â∫∑</div>
                <div class="kangkang-body">
                    <div class="kangkang-head">
                        <div class="kangkang-hair"></div>
                        <div class="kangkang-face">üò§</div>
                    </div>
                    <div class="kangkang-arm">
                        <div class="kangkang-hand"></div>
                    </div>
                </div>
                <div class="kangkang-legs">
                    <div class="kangkang-leg left"></div>
                    <div class="kangkang-leg right"></div>
                </div>
            </div>

            <!-- ÂØπËØùÊ≥°Ê≥° -->
            <div class="speech-bubble hidden" id="speechBubble"></div>

            <!-- Ê∏∏ÊàèUI -->
            <div class="game-ui">
                <div class="score-panel">
                    <div class="score-item">ÂæóÂàÜ: <span id="score">0</span></div>
                    <div class="score-item">ËøûÂáª: <span id="combo">0</span></div>
                    <div class="time-item">Êó∂Èó¥: <span id="time">60</span>s</div>
                </div>

                <div class="leaderboard" id="leaderboard">
                    <h3>üèÜ ÂàáÈîÖÊéíË°åÊ¶ú TOP 10</h3>
                    <div id="leaderboardContent">
                        <!-- ÊéíË°åÊ¶úÂÜÖÂÆπÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê∏∏ÊàèÁªìÊùüÁïåÈù¢ -->
        <div class="game-over" id="gameOver">
            <div class="game-over-box">
                <h2 id="gameOverTitle">ÂàáÈîÖÁªìÊùü!</h2>
                <p id="gameOverScore">ÊÇ®ÁöÑÂæóÂàÜ: 0</p>
                <p id="gameOverRank"></p>
                <button onclick="restartGame()">ÂÜçÂàá‰∏ÄËΩÆ</button>
                <button onclick="backToLogin()">ËøîÂõû‰∏ªÈ°µ</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // FirebaseÈÖçÁΩÆ
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB3ioWABsutPeZ9LboagtxLLgo2kyi9Xnw",
            authDomain: "zhuye-fb0a6.firebaseapp.com",
            databaseURL: "https://zhuye-fb0a6-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "zhuye-fb0a6",
            storageBucket: "zhuye-fb0a6.firebasestorage.app",
            messagingSenderId: "5341756226",
            appId: "1:5341756226:web:1df340a043774db92326db",
            measurementId: "G-BG1920BDX0"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Ê∏∏ÊàèÂèòÈáè
        let currentPlayer = '';
        let gameRunning = false;
        let score = 0;
        let combo = 0;
        let timeLeft = 60;
        let canvas, ctx;
        let gameTimer;
        let spawnTimer;
        let pans = []; // Âπ≥Â∫ïÈîÖÊï∞ÁªÑ
        let particles = []; // Á≤íÂ≠êÊïàÊûúÊï∞ÁªÑ
        let mouseTrail = []; // Èº†Ê†áËΩ®Ëøπ
        let spawnRate = 1200;
        let lastMousePos = { x: 0, y: 0 };

        // Âπ≥Â∫ïÈîÖÁ±ªÂûãÂíåË∂Ö‰∏∞ÂØåÂêêÊßΩÂÜÖÂÆπ
        const panTypes = {
            oa_process: {
                name: 'OAÊµÅÁ®ãÈîÖ',
                color: '#ff6b6b',
                points: 100,
                complaints: [
                    'Ëøô‰∏™OAÊµÅÁ®ãÂ§™Â§çÊùÇ‰∫ÜÔºÅ', 'Ë∞ÅËÆæËÆ°ÁöÑÁ†¥ÊµÅÁ®ãÔºÅ', 'Êàë‰∏çÁÆ°ÔºåÂ∞èÊ¨ß‰Ω†Êù•ÔºÅ', 'ÊµÅÁ®ãËµ∞‰∏çÈÄöÂïäÔºÅ',
                    'Á≥ªÁªüÂèàÂç°‰∫ÜÔºÅ', 'Ëøô‰∏™ÂÆ°ÊâπË¶ÅÁ≠âÂà∞‰ªÄ‰πàÊó∂ÂÄôÔºÅ', 'ÊµÅÁ®ãËÆæËÆ°ÊúâÈóÆÈ¢òÔºÅ', 'Êàë‰∏ç‰ºöÊìç‰ΩúËøô‰∏™ÔºÅ',
                    '‰∏∫‰ªÄ‰πàË¶ÅËøô‰πàÂ§öÊ≠•È™§ÔºÅ', 'ÊµÅÁ®ãÂ§™ÁπÅÁêê‰∫ÜÔºÅ', 'Ëøô‰∏™Ë¥£‰ªª‰∏çÂú®ÊàëÔºÅ', 'Á≥ªÁªüBUG‰∏çÂÖ≥Êàë‰∫ãÔºÅ',
                    'ËøêËê•ÈÉ®Èó®ÁöÑ‰∫ãÔºÅ', 'Ëøô‰∏™ÈîÖÊàë‰∏çËÉåÔºÅ', 'ÊâæITÈÉ®Èó®ÂéªÔºÅ', 'Ë∞ÅËßÑÂÆöÁöÑËøô‰∏™ÊµÅÁ®ãÔºÅ'
                ],
                emoji: 'üìã'
            },
            customer_service: {
                name: 'ÂÆ¢ÊúçÁî©ÈîÖ',
                color: '#4834d4',
                points: 150,
                complaints: [
                    'ÂÆ¢Êà∑ÁöÑ‰∫ãËøêËê•ÁÆ°ÔºÅ', '‰∏çÊòØÊàëË¥üË¥£ÁöÑÔºÅ', 'ÊâæÂ∫∑Â∫∑ÂéªÔºÅ', 'Ëøô‰∏™Êàë‰∏çÂ§ÑÁêÜÔºÅ',
                    'ÂÆ¢Êà∑Â§™Èöæ‰º∫ÂÄô‰∫ÜÔºÅ', 'Ëøô‰∏™ÈóÆÈ¢òÂæàÂ§çÊùÇÔºÅ', '‰∏çÂú®ÊàëÁöÑËÅåË¥£ËåÉÂõ¥ÔºÅ', 'ÊàëÂè™ÊòØ‰º†ËææÊ∂àÊÅØÔºÅ',
                    'ÂÆ¢Êà∑Ëá™Â∑±ÁöÑÈóÆÈ¢òÔºÅ', 'Ëøô‰∏™Ë¶ÅÈóÆ‰∏äÁ∫ßÔºÅ', 'ÊàëÊ≤°ÊùÉÈôêÂ§ÑÁêÜÔºÅ', 'ÂÆ¢Êà∑ÁêÜËß£Èîô‰∫ÜÔºÅ',
                    'Ëøô‰∏™ÈúÄË¶ÅÊäÄÊúØÊîØÊåÅÔºÅ', '‰∏çÊòØÊúçÂä°ÈóÆÈ¢òÔºÅ', 'ÂÆ¢Êà∑Ë¶ÅÊ±ÇÂ§™Â•áÊÄ™ÔºÅ', 'ÊàëËß£Èáä‰∏çÊ∏ÖÊ•öÔºÅ',
                    'ËÆ©ÂÆ¢Êà∑ÊâæÁõ∏ÂÖ≥ÈÉ®Èó®ÔºÅ', 'Ëøô‰∏™ÊàëÁÆ°‰∏ç‰∫ÜÔºÅ', 'ÂÆ¢Êà∑Ê≤°ÊúâËØ¥Ê∏ÖÊ•öÔºÅ', '‰∏çÊòØÊàëÁöÑÈîôÔºÅ'
                ],
                emoji: 'üìû'
            },
            quality_issue: {
                name: 'Ë¥®ÈáèÈóÆÈ¢òÈîÖ',
                color: '#ff9f43',
                points: 200,
                complaints: [
                    'ËçØÂìÅÂéãÊçü‰∏çÂÖ≥Êàë‰∫ãÔºÅ', 'ËøôÊòØÁâ©ÊµÅÈóÆÈ¢òÔºÅ', 'ÈÄÄÁæ§ÁÆó‰∫ÜÔºÅ', 'Ë¥®ÈáèÈÉ®Èó®Ë¥üË¥£ÔºÅ',
                    '‰∏çÊòØÊàë‰ª¨ÁöÑË¥ßÔºÅ', '‰æõÂ∫îÂïÜÁöÑÈóÆÈ¢òÔºÅ', 'ËøêËæìÈÄî‰∏≠ÁöÑ‰∫ãÔºÅ', 'ÂåÖË£Ö‰∏çÊòØÊàëË¥üË¥£ÁöÑÔºÅ',
                    'Ëøô‰∏™ÊâπÊ¨°ÊúâÈóÆÈ¢òÔºÅ', '‰ªìÂ∫ìÁÆ°ÁêÜÁöÑ‰∫ãÔºÅ', '‰∏çÊòØË¥®ÈáèÈóÆÈ¢òÔºÅ', 'ÂÆ¢Êà∑‰øùÂ≠ò‰∏çÂΩìÔºÅ',
                    'ÁéØÂ¢ÉÊ∏©Â∫¶ÂØºËá¥ÁöÑÔºÅ', 'Ëøô‰∏™ÊàëÊ£ÄÊü•Ëøá‰∫ÜÔºÅ', '‰∏çÊòØÊàë‰ª¨ËÉΩÊéßÂà∂ÁöÑÔºÅ', '‰æõÂ∫îÈìæÁöÑÈîÖÔºÅ',
                    'ÂéüÊùêÊñôÂ∞±ÊúâÈóÆÈ¢òÔºÅ', 'Áîü‰∫ßÂ∑•Ëâ∫ÈóÆÈ¢òÔºÅ', '‰∏çÂú®Ë¥®‰øùËåÉÂõ¥ÔºÅ', 'Ëøô‰∏™Ë¶ÅÊâæÂéÇÂÆ∂ÔºÅ',
                    'Ê£ÄÈ™åÊ†áÂáÜ‰∏çÂêåÔºÅ', 'ÂÆ¢Êà∑‰ΩøÁî®ÊñπÊ≥ïÈîôËØØÔºÅ', '‰øùË¥®ÊúüÂÜÖÊ≠£Â∏∏ÔºÅ', 'ËøêËæìÈ¢†Á∞∏ÂØºËá¥ÁöÑÔºÅ'
                ],
                emoji: 'üíä'
            },
            meeting_pot: {
                name: 'ÂºÄ‰ºöÁî©ÈîÖ',
                color: '#00d2d3',
                points: 120,
                complaints: [
                    'ÂºÄ‰ªÄ‰πà‰ºöÂïäÔºÅ', 'Êµ™Ë¥πÊó∂Èó¥ÔºÅ', 'ÊàëÂÖàÈÄÄ‰∫ÜÔºÅ', '‰ºöËÆÆÂ§™Â§ö‰∫ÜÔºÅ',
                    'Ê≤°ÊúâÊÑè‰πâÁöÑ‰ºöÔºÅ', 'ÊàëÊúâÂÖ∂‰ªñ‰∫ãÔºÅ', '‰ºöËÆÆÊïàÁéá‰ΩéÔºÅ', 'ÂèàË¶ÅÂºÄ‰ºöÔºÅ',
                    'ËÆÆÈ¢ò‰∏çÊ∏ÖÊ•öÔºÅ', 'Êàë‰∏çÈúÄË¶ÅÂèÇÂä†ÔºÅ', 'Êó∂Èó¥ÂÆâÊéí‰∏çÂêàÁêÜÔºÅ', '‰ºöËÆÆÂÆ§Â§™ÂêµÔºÅ',
                    'ËÆ®ËÆ∫Ê≤°ÁªìÊûúÔºÅ', '‰ºöËÆÆÊó∂Èó¥Â§™ÈïøÔºÅ', 'ÊàëÊ≤°ÊúâÂèëË®ÄÊùÉÔºÅ', 'ÂÜ≥Á≠ñ‰∏çÂÖ≥Êàë‰∫ãÔºÅ',
                    '‰ºöËÆÆÈÄöÁü•Â§™ÊôöÔºÅ', 'ËÆÆÁ®ãÂÆâÊéíÊúâÈóÆÈ¢òÔºÅ', 'ÊàëÂè™ÊòØÂàóÂ∏≠ÁöÑÔºÅ', 'Ëøô‰∏™‰ºöÊ≤°ÂøÖË¶ÅÔºÅ',
                    'ÊàëÊúâÁ¥ßÊÄ•‰∫ãÂä°ÔºÅ', '‰ºöËÆÆÂÜ≤Á™Å‰∫ÜÔºÅ', 'ËÆ®ËÆ∫ÂÅèÁ¶ª‰∏ªÈ¢òÔºÅ', 'ÁªìËÆ∫‰∏çÊòéÁ°ÆÔºÅ'
                ],
                emoji: 'üë•'
            },
            boss_pot: {
                name: 'ËÄÅÊùøÈîÖ',
                color: '#feca57',
                points: 300,
                complaints: [
                    'ËÄÅÊùøÁöÑÈîÖÊàë‰∏çËÉåÔºÅ', 'ËøôÊòØÁÆ°ÁêÜÈóÆÈ¢òÔºÅ', 'ÊàëÂè™ÊòØÊâßË°åÁöÑÔºÅ', 'ÂÜ≥Á≠ñ‰∏çÊòØÊàëÂÆöÁöÑÔºÅ',
                    'ËÄÅÊùøÊ≤°ËØ¥Ê∏ÖÊ•öÔºÅ', 'ÊåáÁ§∫Ê®°Á≥ä‰∏çÊ∏ÖÔºÅ', 'ÊàëÊåâË¶ÅÊ±ÇÂÅöÁöÑÔºÅ', 'Ëøô‰∏™Ë¶ÅÈóÆËÄÅÊùøÔºÅ',
                    'ÁÆ°ÁêÜÂ±ÇÁöÑÂÜ≥ÂÆöÔºÅ', 'ÊàëÊ≤°ÊúâÂÜ≥Á≠ñÊùÉÔºÅ', 'ËÄÅÊùøË¶ÅÊ±ÇÁöÑÔºÅ', '‰∏çÊòØÊàëÁöÑË¥£‰ªªÔºÅ',
                    '‰∏äÁ∫ßÊåáÁ§∫ÊúâÈóÆÈ¢òÔºÅ', 'ËÄÅÊùøÊîπ‰∏ªÊÑè‰∫ÜÔºÅ', 'ÊîøÁ≠ñÊúù‰ª§Â§ïÊîπÔºÅ', 'ÊàëÂè™ÊòØÂê¨ÂëΩË°å‰∫ãÔºÅ',
                    'ËÄÅÊùøÊ≤°ÊúâËÄÉËôëÂë®ÂÖ®ÔºÅ', 'ÂÜ≥Á≠ñ‰æùÊçÆ‰∏çË∂≥ÔºÅ', 'ËÄÅÊùøÂ§™ÁùÄÊÄ•‰∫ÜÔºÅ', 'Ëøô‰∏™È£éÈô©ÂæàÂ§ßÔºÅ',
                    'ËÄÅÊùø‰∏ç‰∫ÜËß£ÊÉÖÂÜµÔºÅ', 'ÊâßË°åÂ±ÇÈù¢ÊúâÂõ∞ÈöæÔºÅ', 'ËµÑÊ∫ê‰∏çÂ§üÊîØÊåÅÔºÅ', 'Êó∂Èó¥ÂÆâÊéí‰∏çÁé∞ÂÆûÔºÅ',
                    'ËÄÅÊùøÊúüÊúõÂ§™È´òÔºÅ', 'ÁõÆÊ†á‰∏çÂàáÂÆûÈôÖÔºÅ', 'ÊàëÊó©Â∞±ÊèêÈÜíËøáÔºÅ', 'ËÄÅÊùø‰∏çÂê¨Âª∫ËÆÆÔºÅ'
                ],
                emoji: 'üëî'
            }
        };

        // Â∫∑Â∫∑ÁöÑÈöèÊú∫ÂêêÊßΩËØ≠ÂΩï
        const kangkangComplaints = [
            'Ëøô‰∏™ÈîÖÊàë‰∏çËÉåÔºÅ', 'ÊòéÊòæÊòØËøêËê•ÁöÑ‰∫ãÔºÅ', 'ÈÄÄÁæ§ÈÄÄÁæ§ÔºÅ', 'ÊâæÂ∞èÊ¨ßÂéªÔºÅ', '‰∏çÂÖ≥Êàë‰∫ãÔºÅ',
            'ËøôÊµÅÁ®ãÊúâÈóÆÈ¢òÔºÅ', 'ÊàëÁÆ°È¶ñÊé®‰∏çÁÆ°ÈÄÄË¥ßÔºÅ', 'Áî©ÈîÖÂ§ßÊ≥ïÂ•ΩÔºÅ', 'ÂèàË¶ÅÁî©ÈîÖ‰∫ÜÔºÅ', 'ÁúãÊàëÁ•ûÊäÄÔºÅ',
            'ÈîÖÊù•‰∫ÜÈîÖÊù•‰∫ÜÔºÅ', 'Áî©ÈîÖÂ∞èËÉΩÊâã‰∏äÁ∫øÔºÅ', 'Ëøô‰∏™Ë¥£‰ªª‰∏çÊòØÊàëÁöÑÔºÅ', 'Á≥ªÁªüÈóÆÈ¢òÊâæITÔºÅ',
            'ÂÆ¢Êà∑ÈóÆÈ¢òÊâæÂÆ¢ÊúçÔºÅ', 'Ë¥®ÈáèÈóÆÈ¢òÊâæË¥®Ê£ÄÔºÅ', 'ÊµÅÁ®ãÈóÆÈ¢òÊâæËøêËê•ÔºÅ', 'ÁÆ°ÁêÜÈóÆÈ¢òÊâæËÄÅÊùøÔºÅ',
            'ÊàëÂè™ÊòØË¥üË¥£È¶ñÊé®ÔºÅ', 'ÈÄÄË¥ß‰∏çÊòØÊàëÁÆ°ÁöÑÔºÅ', 'OAÊµÅÁ®ãÂ§™Â§çÊùÇÔºÅ', 'Ë∞ÅËÆæËÆ°ÁöÑÁ†¥Á≥ªÁªüÔºÅ'
        ];

        // Âπ≥Â∫ïÈîÖÁ±ª
        class Pan {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                
                // Êõ¥Â§öÊ†∑ÂåñÁöÑÈ£ûË°åË∑ØÂæÑ
                const throwStyle = Math.floor(Math.random() * 4);
                switch(throwStyle) {
                    case 0: // È´òÊäõÁâ©Á∫ø
                        this.vx = Math.random() * 12 + 8;
                        this.vy = -(Math.random() * 20 + 15);
                        break;
                    case 1: // ‰ΩéÂπ≥Êäõ
                        this.vx = Math.random() * 15 + 12;
                        this.vy = -(Math.random() * 10 + 5);
                        break;
                    case 2: // ‰∏≠Á≠âÂºßÂ∫¶
                        this.vx = Math.random() * 10 + 10;
                        this.vy = -(Math.random() * 15 + 10);
                        break;
                    case 3: // Ë∂ÖËøúË∑ùÁ¶ª
                        this.vx = Math.random() * 18 + 15;
                        this.vy = -(Math.random() * 25 + 20);
                        break;
                }
                
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.4;
                this.size = Math.random() * 40 + 60; // Â¢ûÂ§ßÈîÖÂ≠êÂ∞∫ÂØ∏
                this.type = type;
                this.sliced = false;
                this.gravity = 0.4;
                this.trail = [];
                this.maxTrailLength = 12;
            }

            update() {
                if (!this.sliced) {
                    this.vy += this.gravity;
                    this.x += this.vx;
                    this.y += this.vy;
                    this.rotation += this.rotationSpeed;

                    // Ê∑ªÂä†ËΩ®ËøπÁÇπ
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > this.maxTrailLength) {
                        this.trail.shift();
                    }
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // ÁªòÂà∂Â¢ûÂº∫ÁöÑËΩ®ËøπÊïàÊûú
                if (this.trail.length > 1) {
                    for (let i = 1; i < this.trail.length; i++) {
                        const alpha = i / this.trail.length * 0.5;
                        const size = (i / this.trail.length) * 4;
                        
                        ctx.globalAlpha = alpha;
                        ctx.fillStyle = panTypes[this.type].color;
                        ctx.beginPath();
                        ctx.arc(
                            this.trail[i].x - this.x, 
                            this.trail[i].y - this.y, 
                            size, 0, Math.PI * 2
                        );
                        ctx.fill();
                    }
                    ctx.globalAlpha = 1;
                }

                // ÁªòÂà∂Âπ≥Â∫ïÈîÖ‰∏ª‰Ωì
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size / 2);
                gradient.addColorStop(0, panTypes[this.type].color);
                gradient.addColorStop(0.7, this.darkenColor(panTypes[this.type].color, 0.2));
                gradient.addColorStop(1, this.darkenColor(panTypes[this.type].color, 0.4));
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(0, 0, this.size / 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Â¢ûÂº∫ÁöÑËæπÊ°Ü
                ctx.strokeStyle = '#222';
                ctx.lineWidth = 4;
                ctx.stroke();

                // ÈîÖÊüÑËÆæËÆ°Êõ¥Á≤æÁæé
                const handleGradient = ctx.createLinearGradient(this.size / 2, -8, this.size / 2 + this.size / 2.5, 8);
                handleGradient.addColorStop(0, '#8B4513');
                handleGradient.addColorStop(0.5, '#A0522D');
                handleGradient.addColorStop(1, '#654321');
                
                ctx.fillStyle = handleGradient;
                ctx.fillRect(this.size / 2, -8, this.size / 2.5, 16);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.size / 2, -8, this.size / 2.5, 16);

                // Êõ¥Â§ßÁöÑË°®ÊÉÖÁ¨¶Âè∑
                ctx.font = `${this.size / 2.5}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillStyle = 'white';
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.strokeText(panTypes[this.type].emoji, 0, this.size / 8);
                ctx.fillText(panTypes[this.type].emoji, 0, this.size / 8);

                // Ê∑ªÂä†ÂÖâÊ≥ΩÊïàÊûú
                ctx.globalAlpha = 0.3;
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(-this.size / 6, -this.size / 6, this.size / 6, this.size / 8, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;

                ctx.restore();
            }

            darkenColor(color, factor) {
                const hex = color.replace('#', '');
                const r = Math.max(0, parseInt(hex.substr(0, 2), 16) * (1 - factor));
                const g = Math.max(0, parseInt(hex.substr(2, 2), 16) * (1 - factor));
                const b = Math.max(0, parseInt(hex.substr(4, 2), 16) * (1 - factor));
                return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
            }

            isPointInside(x, y) {
                const distance = Math.sqrt((x - this.x) ** 2 + (y - this.y) ** 2);
                return distance < this.size / 2;
            }

            slice() {
                if (!this.sliced) {
                    this.sliced = true;
                    this.createSliceEffect();
                    return panTypes[this.type].points;
                }
                return 0;
            }

            createSliceEffect() {
                // ÂàõÂª∫Êõ¥‰∏∞ÂØåÁöÑÂàáÂâ≤Á≤íÂ≠êÊïàÊûú
                for (let i = 0; i < 20; i++) {
                    particles.push(new Particle(
                        this.x + (Math.random() - 0.5) * this.size,
                        this.y + (Math.random() - 0.5) * this.size,
                        panTypes[this.type].color
                    ));
                }
                
                // Ê∑ªÂä†ÂàáÂâ≤ÂêêÊßΩ
                this.showSliceComplaint();
            }

            showSliceComplaint() {
                const complaints = panTypes[this.type].complaints;
                const randomComplaint = complaints[Math.floor(Math.random() * complaints.length)];
                
                const complaintElement = document.createElement('div');
                complaintElement.className = 'slice-complaint';
                complaintElement.textContent = randomComplaint;
                complaintElement.style.left = this.x + 'px';
                complaintElement.style.top = this.y + 'px';
                
                document.getElementById('gameScreen').appendChild(complaintElement);
                
                setTimeout(() => {
                    if (complaintElement.parentNode) {
                        complaintElement.parentNode.removeChild(complaintElement);
                    }
                }, 2000);
            }
        }

        // Á≤íÂ≠êÁ±ª
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 12;
                this.vy = (Math.random() - 0.5) * 12;
                this.color = color;
                this.life = 1;
                this.decay = Math.random() * 0.015 + 0.015;
                this.size = Math.random() * 10 + 6;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.3; // ÈáçÂäõ
                this.life -= this.decay;
                this.size *= 0.97;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            isDead() {
                return this.life <= 0 || this.size <= 0.5;
            }
        }

        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            score = 0;
            combo = 0;
            timeLeft = 60;
            spawnRate = 1200;
            gameRunning = true;
            pans = [];
            particles = [];
            mouseTrail = [];

            updateUI();
            setupEventListeners();
            startGameLoop();
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨
        function setupEventListeners() {
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mousedown', handleMouseDown);
            
            // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅ
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        }

        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            lastMousePos = { x: mouseX, y: mouseY };
            
            // Ê∑ªÂä†Âà∞Èº†Ê†áËΩ®Ëøπ
            mouseTrail.push({ x: mouseX, y: mouseY, time: Date.now() });
            if (mouseTrail.length > 12) {
                mouseTrail.shift();
            }
            
            checkSlice(mouseX, mouseY);
        }

        function handleMouseDown(e) {
            e.preventDefault();
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const touchX = touch.clientX - rect.left;
            const touchY = touch.clientY - rect.top;
            
            lastMousePos = { x: touchX, y: touchY };
            checkSlice(touchX, touchY);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const touchX = touch.clientX - rect.left;
            const touchY = touch.clientY - rect.top;
            
            lastMousePos = { x: touchX, y: touchY };
            
            mouseTrail.push({ x: touchX, y: touchY, time: Date.now() });
            if (mouseTrail.length > 12) {
                mouseTrail.shift();
            }
            
            checkSlice(touchX, touchY);
        }

        // Ê£ÄÊü•ÂàáÂâ≤
        function checkSlice(x, y) {
            if (!gameRunning) return;
            
            for (let i = pans.length - 1; i >= 0; i--) {
                const pan = pans[i];
                if (!pan.sliced && pan.isPointInside(x, y)) {
                    const points = pan.slice();
                    if (points > 0) {
                        score += points;
                        combo++;
                        
                        // ÊòæÁ§∫ËøûÂáªÊïàÊûú
                        if (combo > 1) {
                            showComboEffect(x, y, combo);
                        }
                        
                        // ÊòæÁ§∫ÂæóÂàÜÊïàÊûú
                        showScoreEffect(x, y, points);
                        
                        updateUI();
                        
                        // ÁßªÈô§Ë¢´ÂàáÁöÑÈîÖ
                        setTimeout(() => {
                            const index = pans.indexOf(pan);
                            if (index > -1) {
                                pans.splice(index, 1);
                            }
                        }, 500);
                    }
                    break;
                }
            }
        }

        // ÊòæÁ§∫ËøûÂáªÊïàÊûú
        function showComboEffect(x, y, comboCount) {
            const comboElement = document.createElement('div');
            comboElement.className = 'combo-text';
            comboElement.textContent = `${comboCount}x COMBO!`;
            comboElement.style.left = x + 'px';
            comboElement.style.top = y + 'px';
            
            document.getElementById('gameScreen').appendChild(comboElement);
            
            setTimeout(() => {
                if (comboElement.parentNode) {
                    comboElement.parentNode.removeChild(comboElement);
                }
            }, 1000);
        }

        // ÊòæÁ§∫ÂæóÂàÜÊïàÊûú
        function showScoreEffect(x, y, points) {
            ctx.save();
            ctx.font = 'bold 28px Arial';
            ctx.fillStyle = '#fff';
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.textAlign = 'center';
            ctx.strokeText(`+${points}`, x, y);
            ctx.fillText(`+${points}`, x, y);
            ctx.restore();
        }

        // ÁîüÊàêÂπ≥Â∫ïÈîÖ
        function spawnPan() {
            if (!gameRunning) return;
            
            const types = Object.keys(panTypes);
            const randomType = types[Math.floor(Math.random() * types.length)];
            
            // ‰ªéÂ∑¶‰∏ãËßíÂ∫∑Â∫∑ÁöÑ‰ΩçÁΩÆÂèëÂ∞Ñ
            const startX = 130;
            const startY = canvas.height - 120;
            
            const pan = new Pan(startX, startY, randomType);
            pans.push(pan);
            
            // Â∫∑Â∫∑ËØ¥ËØù
            showKangkangSpeech();
        }

        // Â∫∑Â∫∑ËØ¥ËØù
        function showKangkangSpeech() {
            const bubble = document.getElementById('speechBubble');
            const randomComplaint = kangkangComplaints[Math.floor(Math.random() * kangkangComplaints.length)];
            
            bubble.textContent = randomComplaint;
            bubble.classList.remove('hidden');
            
            setTimeout(() => {
                bubble.classList.add('hidden');
            }, 4000);
        }

        // Ê∏∏ÊàèÂæ™ÁéØ
        function gameLoop() {
            if (!gameRunning) return;
            
            // Ê∏ÖÁ©∫ÁîªÂ∏É
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ÁªòÂà∂Èº†Ê†áËΩ®ËøπÔºàÂàÄÂÖâÔºâ
            drawMouseTrail();
            
            // Êõ¥Êñ∞ÂíåÁªòÂà∂Âπ≥Â∫ïÈîÖ
            for (let i = pans.length - 1; i >= 0; i--) {
                const pan = pans[i];
                pan.update();
                pan.draw();
                
                // ÁßªÈô§Ë∂ÖÂá∫Â±èÂπïÁöÑÈîÖ
                if (pan.y > canvas.height + 150 || pan.x > canvas.width + 150) {
                    pans.splice(i, 1);
                    // Â¶ÇÊûúÈîÖÊéâ‰∫ÜÔºåÈáçÁΩÆËøûÂáª
                    if (!pan.sliced) {
                        combo = 0;
                        updateUI();
                    }
                }
            }
            
            // Êõ¥Êñ∞ÂíåÁªòÂà∂Á≤íÂ≠ê
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.update();
                particle.draw();
                
                if (particle.isDead()) {
                    particles.splice(i, 1);
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        // ÁªòÂà∂Èº†Ê†áËΩ®Ëøπ
        function drawMouseTrail() {
            if (mouseTrail.length < 2) return;
            
            const now = Date.now();
            
            // Ê∏ÖÁêÜËøáÊúüÁöÑËΩ®ËøπÁÇπ
            for (let i = mouseTrail.length - 1; i >= 0; i--) {
                if (now - mouseTrail[i].time > 250) {
                    mouseTrail.splice(i, 1);
                }
            }
            
            if (mouseTrail.length < 2) return;
            
            ctx.save();
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            for (let i = 1; i < mouseTrail.length; i++) {
                const alpha = i / mouseTrail.length;
                const width = 10 * alpha;
                
                ctx.globalAlpha = alpha;
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = width;
                ctx.shadowColor = '#87CEEB';
                ctx.shadowBlur = 15;
                
                ctx.beginPath();
                ctx.moveTo(mouseTrail[i - 1].x, mouseTrail[i - 1].y);
                ctx.lineTo(mouseTrail[i].x, mouseTrail[i].y);
                ctx.stroke();
            }
            
            ctx.restore();
        }

        // ÂºÄÂßãÊ∏∏ÊàèÂæ™ÁéØ
        function startGameLoop() {
            // ËÆ°Êó∂Âô®
            gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                
                if (timeLeft <= 0) {
                    endGame();
                    return;
                }
                
                // ÈöæÂ∫¶ÈÄíÂ¢û
                if (timeLeft % 8 === 0 && spawnRate > 200) {
                    spawnRate -= 80;
                    clearInterval(spawnTimer);
                    spawnTimer = setInterval(spawnPan, spawnRate);
                }
            }, 1000);

            // ÁîüÊàêÂπ≥Â∫ïÈîÖ
            spawnTimer = setInterval(spawnPan, spawnRate);
            
            // ÂºÄÂßãÊ∏∏ÊàèÂæ™ÁéØ
            gameLoop();
        }

        // Êõ¥Êñ∞UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('combo').textContent = combo;
            document.getElementById('time').textContent = timeLeft;
        }

        // ÁªìÊùüÊ∏∏Êàè
        async function endGame() {
            gameRunning = false;
            clearInterval(gameTimer);
            clearInterval(spawnTimer);
            
            await saveScore();
            await loadLeaderboard();
            showGameOver();
        }

        // ÊòæÁ§∫Ê∏∏ÊàèÁªìÊùüÁïåÈù¢
        async function showGameOver() {
            const gameOverElement = document.getElementById('gameOver');
            const titleElement = document.getElementById('gameOverTitle');
            const scoreElement = document.getElementById('gameOverScore');
            const rankElement = document.getElementById('gameOverRank');
            
            scoreElement.textContent = `ÊÇ®ÁöÑÂæóÂàÜ: ${score}`;
            
            const rank = await getPlayerRank();
            if (rank <= 10) {
                titleElement.textContent = 'üéâ ÊàêÂäü‰∏äÊ¶úÔºÅ';
                rankElement.textContent = `ÊéíÂêç: Á¨¨${rank}Âêç`;
            } else {
                titleElement.textContent = 'ÁªßÁª≠Âä™ÂäõÂàáÈîÖÔºÅ';
                rankElement.textContent = `ÊéíÂêç: Á¨¨${rank}Âêç`;
            }
            
            gameOverElement.style.display = 'flex';
        }

        // ‰øùÂ≠òÂàÜÊï∞
        async function saveScore() {
            try {
                const playerRef = ref(database, `youxi/${currentPlayer}`);
                const snapshot = await get(playerRef);
                
                if (snapshot.exists()) {
                    const currentBest = snapshot.val().score;
                    if (score > currentBest) {
                        await set(playerRef, {
                            nickname: currentPlayer,
                            score: score,
                            timestamp: Date.now()
                        });
                    }
                } else {
                    await set(playerRef, {
                        nickname: currentPlayer,
                        score: score,
                        timestamp: Date.now()
                    });
                }
            } catch (error) {
                console.error('‰øùÂ≠òÂàÜÊï∞Â§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÊéíË°åÊ¶ú
        async function loadLeaderboard() {
            try {
                const scoresRef = ref(database, 'youxi');
                const snapshot = await get(scoresRef);
                
                if (snapshot.exists()) {
                    const scores = [];
                    snapshot.forEach((child) => {
                        scores.push(child.val());
                    });
                    
                    scores.sort((a, b) => b.score - a.score);
                    displayLeaderboard(scores.slice(0, 10));
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊéíË°åÊ¶úÂ§±Ë¥•:', error);
            }
        }

        // ÊòæÁ§∫ÊéíË°åÊ¶ú
        function displayLeaderboard(scores) {
            const content = document.getElementById('leaderboardContent');
            content.innerHTML = '';
            
            scores.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = `leaderboard-item ${index < 3 ? 'top3' : ''}`;
                
                const rank = index + 1;
                const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `${rank}.`;
                
                item.innerHTML = `
                    <span>${medal} ${player.nickname}</span>
                    <span>${player.score}</span>
                `;
                
                content.appendChild(item);
            });
        }

        // Ëé∑ÂèñÁé©ÂÆ∂ÊéíÂêç
        async function getPlayerRank() {
            try {
                const scoresRef = ref(database, 'youxi');
                const snapshot = await get(scoresRef);
                
                if (snapshot.exists()) {
                    const scores = [];
                    snapshot.forEach((child) => {
                        scores.push(child.val());
                    });
                    
                    scores.sort((a, b) => b.score - a.score);
                    
                    for (let i = 0; i < scores.length; i++) {
                        if (scores[i].nickname === currentPlayer) {
                            return i + 1;
                        }
                    }
                }
                return 999;
            } catch (error) {
                console.error('Ëé∑ÂèñÊéíÂêçÂ§±Ë¥•:', error);
                return 999;
            }
        }

        // ÂÖ®Â±ÄÂáΩÊï∞
        window.startGame = async function() {
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname) {
                alert('ËØ∑ËæìÂÖ•ÊòµÁß∞ÂºÄÂßãÂàáÈîÖÔºÅ');
                return;
            }
            
            currentPlayer = nickname;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            await loadLeaderboard();
            initGame();
        };

        window.restartGame = function() {
            document.getElementById('gameOver').style.display = 'none';
            initGame();
        };

        window.backToLogin = function() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('nicknameInput').value = '';
        };

        // Á™óÂè£Â§ßÂ∞èÂèòÂåñÊó∂ÈáçÊñ∞Ë∞ÉÊï¥ÁîªÂ∏É
        window.addEventListener('resize', () => {
            if (canvas) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
        });

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        window.addEventListener('load', async () => {
            await loadLeaderboard();
        });
    </script>
</body>
</html>
